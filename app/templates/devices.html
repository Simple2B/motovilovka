{% extends "base.html" %} {% block links %}

<link
  href="{{ url_for('static', filename='css/search.css') }}"
  rel="stylesheet"
  media="screen"
/>
{% endblock %} {% block content %}
<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
  <div class="d-flex justify-content-between pt-3">
    <h3 class="page_title mt-1">Devices</h3>
  </div>
  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Connection</th>
        </tr>
      </thead>
      <tbody class="device-dashboard">
        {% for device in devices.items%}
        <tr class="account-{{ device.account.mqtt_login }}">
          <td class="device-name" name="{{ device.name }}">{{ device.name }}</td>
          <td class="device-type" name="{{device.type}}">
            {% if device.type not in device_known_types %}
            {{ device.type }}
            {% else %}
            <!-- prettier-ignore -->
            <a href="{{url_for('devices.device_page', device_uid=device.uid)}}">{{ device.type }}</a>
            {% endif %}
          </td>
          <td class="indicator">
            <svg hidden class="device-off text-danger"xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-wifi-off" viewBox="0 0 16 16">
              <path d="M10.706 3.294A12.545 12.545 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .668.05A11.448 11.448 0 0 1 8 4c.63 0 1.249.05 1.852.148l.854-.854zM8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065 8.448 8.448 0 0 1 3.51-1.27L8 6zm2.596 1.404.785-.785c.63.24 1.227.545 1.785.907a.482.482 0 0 1 .063.745.525.525 0 0 1-.652.065 8.462 8.462 0 0 0-1.98-.932zM8 10l.933-.933a6.455 6.455 0 0 1 2.013.637c.285.145.326.524.1.75l-.015.015a.532.532 0 0 1-.611.09A5.478 5.478 0 0 0 8 10zm4.905-4.905.747-.747c.59.3 1.153.645 1.685 1.03a.485.485 0 0 1 .047.737.518.518 0 0 1-.668.05 11.493 11.493 0 0 0-1.811-1.07zM9.02 11.78c.238.14.236.464.04.66l-.707.706a.5.5 0 0 1-.707 0l-.707-.707c-.195-.195-.197-.518.04-.66A1.99 1.99 0 0 1 8 11.5c.374 0 .723.102 1.021.28zm4.355-9.905a.53.53 0 0 1 .75.75l-10.75 10.75a.53.53 0 0 1-.75-.75l10.75-10.75z"/>
            </svg>
            <svg hidden class="device-on text-success" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-wifi" viewBox="0 0 16 16">
              <path d="M15.384 6.115a.485.485 0 0 0-.047-.736A12.444 12.444 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .668.05A11.448 11.448 0 0 1 8 4c2.507 0 4.827.802 6.716 2.164.205.148.49.13.668-.049z"/>
              <path d="M13.229 8.271a.482.482 0 0 0-.063-.745A9.455 9.455 0 0 0 8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065A8.46 8.46 0 0 1 8 7a8.46 8.46 0 0 1 4.576 1.336c.206.132.48.108.653-.065zm-2.183 2.183c.226-.226.185-.605-.1-.75A6.473 6.473 0 0 0 8 9c-1.06 0-2.062.254-2.946.704-.285.145-.326.524-.1.75l.015.015c.16.16.407.19.611.09A5.478 5.478 0 0 1 8 10c.868 0 1.69.201 2.42.56.203.1.45.07.61-.091l.016-.015zM9.06 12.44c.196-.196.198-.52-.04-.66A1.99 1.99 0 0 0 8 11.5a1.99 1.99 0 0 0-1.02.28c-.238.14-.236.464-.04.66l.706.706a.5.5 0 0 0 .707 0l.707-.707z"/>
            </svg>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination d-flex justify-content-center">
      <!-- prettier-ignore -->
      {% if query %}
        {% for page_num in devices.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=3) %}
          {% if page_num %}
            {% if devices.page == page_num %}
      <a
        class="page_button btn btn-dark mb-4 mx-1"
        href="{{ url_for('devices.device_search', query=query, page=page_num) }}"
        >{{ page_num }}</a
      >
      {% else %}
      <a
        class="page_button btn btn-outline-dark mb-4 mx-1"
        href="{{ url_for('devices.device_search', query=query, page=page_num) }}"
        >{{ page_num }}</a
      >
      {% endif %}
      <!-- prettier-ignore -->
      {% else %}
      <a class="page_button btn btn-outline-dark mb-4 mx-1" href="#">...</a>
      {% endif %}
      <!-- prettier-ignore -->
      {% endfor %}
      {% else %}
      {% for page_num in devices.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=3) %}
      {% if page_num %}
      {% if devices.page == page_num %}
      <a
        class="page_button btn btn-dark mb-4 mx-1"
        href="{{ url_for('devices.devices_page', page=page_num) }}"
        >{{ page_num }}</a
      >
      {% else %}
      <a
        class="page_button btn btn-outline-dark mb-4 mx-1"
        href="{{ url_for('devices.devices_page', page=page_num) }}"
        >{{ page_num }}</a
      >
      {% endif %}
      <!-- prettier-ignore -->
      {% else %}
      <a class="page_button btn btn-outline-dark mb-4 mx-1" href="#">...</a>
      {% endif %}
      <!-- prettier-ignore -->
      {% endfor %}
      {% endif %}
    </div>
  </div>
</main>
{% endblock %} {% block scripts %}
<script
  src="{{ url_for('static', filename='js/search.js') }}"
  type="text/javascript"
></script>

<script>
  const mqttData = {
    accounts: [
      {% for account in accounts %}
        {
          username: "{{ account.mqtt_login }}",
          password: "{{ account.mqtt_password }}",
        },
      {% endfor %}
    ],
    port: "{{ mqtt_port }}",
  };
</script>
<script src="{{ url_for('static', filename='js/uuidv4.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/mqtt/mqtt.js')}}"></script>
<script src="{{ url_for('static', filename='js/device_dashboard.js') }}"></script>
{% endblock %}
